function addPlayerClub(doValidate){var team_id=$("input[name=team_hid]").val();var season_from=$("select[name=season_from]").val();var season_to=$("select[name=season_to]").val();var connection_id=$("input[name=edited_connection]").val();var transferLink=$("#transferLink").val();var positionInput=$("select[name=position]");var date_from=$("input[name=date_from]").length>0?$("input[name=date_from]").val():null;var date_to=$("input[name=date_to]").length>0?$("input[name=date_to]").val():null;if(transferLink!=null&&transferLink!=""&&(!validateURL(transferLink)||!urlHasParamOrPath(transferLink)||urlTransfersIsAmongBlocked(transferLink))){transferLink=null}if(!globalAddingConnection){globalLockUnlockSubmit(true);if(!doValidate||validateAddPlayerClub(team_id,season_from,season_to,date_from,date_to,positionInput)){$.ajax({type:"POST",url:basedir+"ajax/add_team_player",data:{team_id:team_id,player_id:$(".item-profile").data("id"),season_from:season_from,season_to:season_to,date_from:date_from,date_to:date_to,position:positionInput.val(),connection_id:connection_id,link:transferLink,edit_confirmation:getEditConfirmationValue()},success:function(data){if(typeof data==="string"){data=JSON.parse(data)}if(data["code"]==1){refreshTab()}else{$("#add_club_container").append('<p class="errors">'+data["error"]+"</p>")}globalLockUnlockSubmit(false)},error:function(){globalLockUnlockSubmit(false);showInfoDialog(vblang("error.common"),vblang("dialog.error"))}})}else{globalLockUnlockSubmit(false)}}}function validateAddPlayerClub(team_id,season_from,season_to,date_from,date_to,positionInput){$("#add_club_container select, #add_club_container input, #add_club_container textarea").css("border-color","");$("#add_club_container p.errors").remove();var valid=true;var transferLinkInput=$("#add_club_container #transferLink");if(transferLinkInput.is(":visible")&&userP!=$(".item-profile").data("id")){if(transferLinkInput.val()==null||transferLinkInput.val()==""){transferLinkInput.css("border-color","red");$("#add_club_container").append('<p class="errors">'+vblang("error.link.required")+"</p>");valid=false}else if(!validateURL(transferLinkInput.val())||!urlHasParamOrPath(transferLinkInput.val())||urlTransfersIsAmongBlocked(transferLinkInput.val())){transferLinkInput.css("border-color","red");$("#add_club_container").append('<p class="errors">'+vblang("error.link.invalid")+"</p>");valid=false}}if(team_id==""||team_id=="0"||team_id=="-1"){$("#teamAutocompleter").css("border-color","red");$("#add_club_container").append('<p class="errors">'+vblang("error.team_arena.club")+"</p>");valid=false}if(season_from==""||season_from=="0"||season_from=="-1"){$("#season_from").css("border-color","red");$("#add_club_container").append('<p class="errors">'+vblang("error.team_player.season_frrom")+"</p>");valid=false}if(season_from!=""&&season_from!="0"&&season_to!=""&&season_to!="0"&&parseInt(season_from,10)>parseInt(season_to,10)){$("#season_from").css("border-color","red");$("#season_to").css("border-color","red");$("#add_club_container").append('<p class="errors">'+vblang("error.team_player.season_to")+"</p>");valid=false}if(date_from!=null&&date_to!=null&&new Date(date_from)>new Date(date_to)){$("input[name=date_from]").css("border-color","red");$("input[name=date_to]").css("border-color","red");$("#add_club_container").append('<p class="errors">Ending date should be greater than starting date.</p>');valid=false}if(positionInput.is(":visible")&&(positionInput.val()=="0"||positionInput.val()=="")){positionInput.css("border-color","red");$("#add_club_container").append('<p class="errors">'+vblang("error.team_player.position")+"</p>");valid=false}if($("#edit_confirmation").length>0&&$("#edit_confirmation").is(":visible")&&$.trim($("#edit_confirmation").val())==""){$("#edit_confirmation").css("border-color","red");$("#add_club_container").append('<p class="errors">'+vblang("error.team_player.proof")+"</p>");valid=false}if(valid&&(season_from!=""&&season_from!="0"||season_to!=""&&season_to!="0")){var season_id=season_from!=""?season_from:season_to;$.ajax({type:"POST",url:basedir+"ajax/if_club_exist_season",data:{season_id:season_id,team_id:team_id},success:function(data){if(data=="1"){addPlayerClub(false)}else{$("select[name=season_from]").css("border-color","red");$("#add_club_container").append('<p class="errors">Club didn\'t exists yet. Minimum season is '+data+".</p>")}}})}else{return valid}}function setAvailableSeasonForTeam(teamType){var seasonSelector=teamType=="N"?"#season_national":"#season_clubs";$(seasonSelector+" option").each(function(){$('#season_from option[value="'+$(this).val()+'"]').text($(this).text());$('#season_to option[value="'+$(this).val()+'"]').text($(this).text())})}function showTransferField(editLink){var editedConnection=$("input[name=edited_connection]").val();var selectField=$('#add_club_container select[name="season_from"]');var transferLink$=$("#transferLink");if(editedConnection==""&&$('#add_club_container input[name="team_hid"]').val()!=""&&selectField.val()!=""&&parseInt(selectField.val())>=currentSeasonId){transferLink$.val("");transferLink$.show()}else{if($("#team_arena_"+editedConnection+" .link-details").length>0){if(editLink){transferLink$.val($("#team_arena_"+editedConnection+" .link-details a").attr("href"))}transferLink$.show()}else{transferLink$.val("");transferLink$.hide()}}}function setTeamAutocompleterParams(){const position=$('#add_club_container select[name="position"]').val();const teamAutocompleterParams$=$("#teamAutocompleter").closest(".autocomplete-item-suggestions").find(".autocomplete-parameters");const staffPositions=$("#add_club_container").data("staff-positions").split(",");if(staffPositions&&staffPositions.includes(position)){teamAutocompleterParams$.find('input[name="gender"]').val("");teamAutocompleterParams$.find('input[name="type"]').val("")}else{teamAutocompleterParams$.find('input[name="gender"]').val($(".item-profile").data("gender"));teamAutocompleterParams$.find('input[name="type"]').val("C")}}$(function(){if(userId!="0"){$('#add_club_container select[name="season_from"]').change(function(){showTransferField(false)});$('#add_club_container select[name="position"]').change(function(){setTeamAutocompleterParams()});$("#teamAutocompleter").on("selectedItemEvent",function(event,param1,param2){setAvailableSeasonForTeam(param2);showTransferField(false)});$("#teamAutocompleter").on("addNewItemEvent",function(){if(userId=="0"){showUnloggedInfo(vblang("logged.clubs"))}else{addCreateClubDialog();createClubDialogLoadContent(null,null,$(".item-profile").data("gender"),null)}});addAutocompleteTriggers();setTeamAutocompleterParams()}var teamParametersInputs=$("#teamAutocompleter").closest(".autocomplete-item-suggestions").find(".autocomplete-parameters").find('input[type="hidden"]');$(".person-experience .add-ex-btn, .person-experience .edit_icon").click(function(){if(userId!="0"){setAvailableSeasonForTeam($(this).closest(".team_arena_box").find(".arenaName").data("subtype"));teamParametersInputs.each(function(){if($(this).val()){$(this).data("value",$(this).val());$(this).val("")}})}else{showUnloggedInfo(vblang("logged.clubs"))}});$(".player-experience .add-ex-btn, .addClubBox .add-ex-btn, .player-experience .edit_icon").click(function(){if(userId!="0"){setAvailableSeasonForTeam($(this).closest(".team_arena_box").find(".arenaName").data("subtype"));teamParametersInputs.each(function(){if($(this).data("value")){$(this).val($(this).data("value"))}})}else{showUnloggedInfo(vblang("logged.clubs"))}});$(".add_connection_cnt").on("shown",function(){showTransferField(true)});$(document).click(function(event){$(".more-options .dd-menu").each(function(){if($(this).css("display")!=="none"&&$(event.target).closest(".more-options").length===0){$(this).slideUp()}})})});