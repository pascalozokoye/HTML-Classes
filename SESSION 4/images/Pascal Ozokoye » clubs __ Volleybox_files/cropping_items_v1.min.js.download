var wallpaperContainer=$("<div/>");wallpaperContainer.hide();wallpaperContainer.attr("id","wallpaper-container");var originalFile=null;var originalWallpaper=null;function addDragBoxForElement(element){element.on("dragover",function(e){e.preventDefault();e.stopPropagation()});element.on("dragenter",function(e){e.preventDefault();e.stopPropagation()});element.on("drop",function(e){if(e.originalEvent.dataTransfer&&e.originalEvent.dataTransfer.files.length){e.preventDefault();e.stopPropagation();if(!($.inArray(e.originalEvent.dataTransfer.files[0].type,["image/gif","image/png","image/jpg","image/jpeg","image/webp"])==-1)){if(element.hasClass("image_container")){readFile(e.originalEvent.dataTransfer.files[0])}else if(element.hasClass("fanclub_stats")){readWallpaper(e.originalEvent.dataTransfer.files[0])}}}})}$(function(){var fanclubStats$=$(".fanclub_stats");var imagePhotoInput$=$("input[name=image_photo]");var addPhotoForm$=$("#add_photo_form");installAddPhotoTrigger();fanclubStats$.html(wallpaperContainer);imagePhotoInput$.change(function(){if(!correctExtenstion($(this).val())){showInfoDialog(vblang("error.file_types"),vblang("dialog.error"))}else{if(this.files&&this.files[0]){readFile(this.files[0],addPhotoForm$)}}});$("input[name=wallpaper_photo]").change(function(){if(!correctExtenstion($(this).val())){showInfoDialog(vblang("error.file_types"),vblang("dialog.error"))}else{if(this.files&&this.files[0]){readWallpaper(this.files[0])}}});$("#add_photo_trigger").click(function(){imagePhotoInput$.trigger("click")});$(".add-wallpaper-btn").click(function(){if($(this).hasClass("edit-wallpaper-btn")){openEditWallpaperDialog($(this).data("id"))}else{$("input[name=wallpaper_photo]").trigger("click")}});$("#add_photo_cancel").click(function(){$(".profile_left.image_container").show();showAddPhotoTrigger();addPhotoForm$.hide();$("#item").hide()});$("#add_wallpaper_cancel").click(function(){wallpaperContainer.hide();$(".item-profile").removeClass("added_wallpaper");$(".fanclub_stats_container").removeClass("added-wallpaper");$(".add_wallpaper_buttons").hide();$(".profile_buttons").show()});$("#add_wallpaper_save").click(function(){$uploadWallpaperCrop.croppie("result",{type:"rawcanvas",size:"original",quality:.9,format:"jpeg"}).then(function(resp){resample_single(resp,1449,400,true);addLoadingToButton($("#add_wallpaper_save"),true);$.ajax({dataType:"xml",type:"POST",data:{wallpaper_photo:resp.toDataURL(),item_id:addPhotoForm$.find('input[name="item_id"]').val(),item_type:addPhotoForm$.find('input[name="item_type"]').val(),file:originalWallpaper},url:basedir+"ajax/add_wallpaper_ajax",success:function(data){addLoadingToButton($("#add_wallpaper_save"),false);if($("response code",data).text()=="1"){$("#add_wallpaper_cancel").trigger("click");$("head").append("<style>.fanclub_stats::before,.fanclub_stats::after{background-image: "+"linear-gradient(rgba(0,0,0,0) 71%, rgba(0,0,0, .53)),url("+$("response image",data).text()+");}</style>");$(".fanclub_stats_container").removeClass("has-wallpaper").addClass("has-new-wallpaper");$(".item-profile").addClass("has_wallpaper").addClass("added_wallpaper")}else{$("#add_wallpaper_cancel").trigger("click");showInfoDialog(vblang("photo.save_eror"),vblang("dialog.error"));addLoadingToButton($("#add_photo_save"),false)}return false},error:function(){$("#add_wallpaper_cancel").trigger("click");showInfoDialog(vblang("photo.save_eror"),vblang("dialog.error"));addLoadingToButton($("#add_photo_save"),false)}})})});addDragBoxForElement($(".image_container"));addDragBoxForElement(fanclubStats$);addPhotoForm$.submit(function(e){e.preventDefault();$uploadCrop.croppie("result",{type:"rawcanvas",size:"original"}).then(function(resp){addLoadingToButton($("#add_photo_save"),true);resample_single(resp,200,200,true);$.ajax({dataType:"xml",type:"POST",data:{image_photo:resp.toDataURL(),item_id:addPhotoForm$.find('input[name="item_id"]').val(),item_type:addPhotoForm$.find('input[name="item_type"]').val(),file:originalFile},url:basedir+"ajax/add_photo_ajax",success:function(data){addLoadingToButton($("#add_photo_save"),false);if($("response code",data).text()=="1"){$("#item").hide();addPhotoForm$.hide();$(".profile_left.image_container").show();var src=$("response image",data).text();var big_src=$("response big_image",data).text();$(".profile_left img").attr("src",src);if(big_src){$(".profile_left img").data("big-src",big_src)}$(".image-container-img-link").attr("href",big_src?big_src:src)}else{$("#add_photo_buttons").show();showInfoDialog(vblang("photo.save_eror"),vblang("dialog.error"))}return false},error:function(){showInfoDialog(vblang("photo.save_eror"),vblang("dialog.error"));addLoadingToButton($("#add_photo_save"),false)}})})});$uploadCrop=$("#item").croppie({viewport:{width:200,height:200,type:"square"},boundary:{width:200,height:200},exif:true});initializeUploadWallpaperCrop(fanclubStats$)});function installAddPhotoTrigger(){$(".image_container, .image_container *").hover(function(){if(!$("#add_photo_form").is(":visible")){showAddPhotoTrigger();$(".photo_author_container").animate({top:"0px"},{duration:100,queue:false})}},function(){hideAddPhotoTrigger();$(".photo_author_container").animate({top:"-60px"},{duration:100,queue:false})})}function initializeUploadWallpaperCrop(fanclubStats$){var fanclubStatsWidth=fanclubStats$.width();$uploadWallpaperCrop=wallpaperContainer.croppie({viewport:{width:fanclubStatsWidth,height:400*(fanclubStatsWidth/1449),type:"square"},boundary:{width:fanclubStatsWidth,height:400*(fanclubStatsWidth/1449)},showZoomer:false,exif:true})}function readFile(file,addPhotoForm$){var bigImage=$("#add_photo_form").data("big-image")==1;$("#item").show();$(".profile_left.image_container").hide();hideAddPhotoTrigger();$('input[name="image_photo"]').hide();$('input[name="wallpaper_photo"]').hide();$(".user-rounded-icon-container").hide();addPhotoForm$.show();$("#add_photo_buttons").show();if(file){var reader=new FileReader;reader.onload=function(e){$uploadCrop.croppie("bind",{url:e.target.result});if(bigImage){originalFile=e.target.result}};reader.readAsDataURL(file)}else{swal("Sorry - you're browser doesn't support the FileReader API")}}function readWallpaper(file){var bigImage=$("#add_photo_form").data("big-image")==1;var addWallpaperButtons$=$(".add_wallpaper_buttons");wallpaperContainer.show();$(".fanclub_stats_container").addClass("added-wallpaper");$(".item-profile").addClass("added_wallpaper");if(isMobile=="true"){addWallpaperButtons$.prependTo(".item-profile-new")}else{addWallpaperButtons$.appendTo(".tabs-profile")}addWallpaperButtons$.show();$(".profile_buttons").hide();$('input[name="image_photo"]').hide();$('input[name="wallpaper_photo"]').hide();if(file){var readerWallpaper=new FileReader;readerWallpaper.onload=function(e){$uploadWallpaperCrop.croppie("bind",{url:e.target.result});if(bigImage){originalWallpaper=e.target.result}};readerWallpaper.readAsDataURL(file)}else{swal("Sorry - you're browser doesn't support the FileReader API")}}